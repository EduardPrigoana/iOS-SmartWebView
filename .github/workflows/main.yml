name: Build iOS .ipa (unsigned)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build .ipa without signing
        run: |
          # Build archive
          xcodebuild -project iOS-SmartWebView.xcodeproj \
            -scheme iOS-SmartWebView \
            -configuration Release \
            -archivePath build/iOS-SmartWebView.xcarchive \
            CODE_SIGNING_ALLOWED=NO \
            clean archive
          
          # Create IPA directory
          mkdir -p build/ipa/Payload
          
          # Copy .app bundle to Payload
          cp -r build/iOS-SmartWebView.xcarchive/Products/Applications/iOS-SmartWebView.app build/ipa/Payload/
          
          # Zip the Payload folder to create IPA
          cd build/ipa
          zip -r iOS-SmartWebView.ipa Payload
          cd ../..

      - name: Upload unsigned .ipa
        uses: actions/upload-artifact@v4
        with:
          name: UnsignedApp.ipa
          path: build/ipa/iOS-SmartWebView.ipa
